@page
@model AplicatieLicenta.Pages.Admin.CreeazaTestModel
@{
    Layout = "~/Pages/Shared/AdminLayout.cshtml";
    ViewData["Title"] = "Creează un test nou";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-4">
    <h2 class="mb-4">📝 Creează un test nou</h2>

    <form method="post" asp-page-handler="SalveazaTest">
        <div class="mb-3">
            <label class="form-label">Titlu test:</label>
            <input asp-for="Quiz.Titlu" class="form-control" />
            <span asp-validation-for="Quiz.Titlu" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <label class="form-label">Cartea:</label>
            <select asp-for="Quiz.CarteId" asp-items="Model.CartiDisponibile" class="form-select"></select>
            <span asp-validation-for="Quiz.CarteId" class="text-danger"></span>
        </div>

        <!-- 🟢 Acestea vin DUPĂ câmpurile vizibile -->
        <input type="hidden" name="quizTitluHidden" value="@Model.Quiz.Titlu" />
        <input type="hidden" name="quizCarteIdHidden" value="@Model.Quiz.CarteId" />

        <button type="submit" class="btn btn-success">💾 Salvează testul complet</button>
    </form>

    <div class="card mt-5">
        <div class="card-header bg-primary text-white">
            ➕ Adaugă o întrebare
        </div>
        <div class="card-body">
            <form method="post" asp-page-handler="AdaugaIntrebare">
                <input type="hidden" asp-for="Quiz.Titlu" />
                <input type="hidden" asp-for="Quiz.CarteId" />

                <div class="mb-3">
                    <label class="form-label">Enunț întrebare:</label>
                    <input asp-for="IntrebareNoua.Enunt" class="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Categorie întrebare:</label>
                    <select asp-for="IntrebareNoua.Categorie" class="form-select">
                        <option value="">-- Selectează o categorie --</option>
                        <option value="Personaje">Personaje</option>
                        <option value="Emotii">Emoții</option>
                        <option value="Actiune">Acțiune</option>
                    </select>
                </div>

                <label class="form-label">Variante de răspuns:</label>
                @for (int i = 0; i < 4; i++)
                {
                    <div class="input-group mb-2">
                        <input name="VarianteRaspunsNou[@i].Text" class="form-control" placeholder="Text răspuns" />
                        <div class="input-group-text">
                            <input type="hidden" name="VarianteRaspunsNou[@i].EsteCorect" value="false" />
                            <input type="checkbox" name="VarianteRaspunsNou[@i].EsteCorect" value="true" class="form-check-input mt-0" />
                            &nbsp;Corect
                        </div>
                    </div>
                }

                <button type="submit" class="btn btn-outline-primary mt-2">➕ Adaugă întrebarea</button>
            </form>
        </div>
    </div>

    @if (Model.IntrebariTemp.Any())
    {
        <div class="mt-4">
            <h4>📚 Întrebări adăugate:</h4>
            <ul class="list-group">
                @foreach (var i in Model.IntrebariTemp)
                {
                    <li class="list-group-item">
                        <strong>@i.Enunt</strong> — <em>@i.Categorie</em>
                    </li>
                }
            </ul>
        </div>
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
